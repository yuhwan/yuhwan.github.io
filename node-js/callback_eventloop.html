<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Re:coder | 6. 콜백과 이벤트 루프</title>
    <meta name="description" content="Welcome to Re:coder site">
    
    
    <link rel="preload" href="/assets/css/10.styles.15a5b012.css" as="style"><link rel="preload" href="/assets/js/app.07d17a6a.js" as="script"><link rel="preload" href="/assets/js/6.ca452530.js" as="script"><link rel="prefetch" href="/assets/js/2.b402c848.js"><link rel="prefetch" href="/assets/js/0.5cddfe8e.js"><link rel="prefetch" href="/assets/js/1.38c34eec.js"><link rel="prefetch" href="/assets/js/3.48f2d762.js"><link rel="prefetch" href="/assets/js/4.db537a04.js"><link rel="prefetch" href="/assets/js/5.3132f110.js"><link rel="prefetch" href="/assets/js/7.79d756ff.js"><link rel="prefetch" href="/assets/js/8.34218bc9.js"><link rel="prefetch" href="/assets/js/9.569ba01d.js">
    <link rel="stylesheet" href="/assets/css/10.styles.15a5b012.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div><a href="/" class="home-link router-link-active"><!----><span class="site-name">
      Re:coder
    </span></a><div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""><!----></div><nav class="nav-links can-hide"><div class="nav-item"><a href="/node-js/" class="nav-link router-link-active">Node.js</a></div><!----></nav></div></header><div class="sidebar-mask"></div><div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/node-js/" class="nav-link router-link-active">Node.js</a></div><!----></nav><ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>6. 콜백과 이벤트 루프</span><!----></p><ul class="sidebar-group-items"><li><a href="/node-js/callback_eventloop.html#callback-function" class="sidebar-link">Callback Function</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/node-js/callback_eventloop.html#callback-function-on-browser" class="sidebar-link">Callback function on browser</a></li><li class="sidebar-sub-header"><a href="/node-js/callback_eventloop.html#callback-function-on-node-js" class="sidebar-link">Callback Function  on Node.js</a></li></ul></li><li><a href="/node-js/callback_eventloop.html#event-loop" class="sidebar-link">Event Loop</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/node-js/callback_eventloop.html#_1-heap-space" class="sidebar-link">1. Heap Space</a></li><li class="sidebar-sub-header"><a href="/node-js/callback_eventloop.html#_2-call-stack" class="sidebar-link">2. Call stack</a></li><li class="sidebar-sub-header"><a href="/node-js/callback_eventloop.html#_3-asynchronous-apis" class="sidebar-link">3. Asynchronous APIs</a></li></ul></li></ul></div></li></ul></div><div class="page"><div class="content"><h1 id="_6-콜백과-이벤트-루프"><a href="#_6-콜백과-이벤트-루프" aria-hidden="true" class="header-anchor">#</a> 6. 콜백과 이벤트 루프</h1><h2 id="callback-function"><a href="#callback-function" aria-hidden="true" class="header-anchor">#</a> Callback Function</h2><p>콜백 함수는 <code>다른 함수에 파라미터로 전달이 되었다가 특정 시점에 실행되는 함수</code>를 일컫습니다. 따라서, 파라미터로 전달되는 모든 함수는 콜백함수라고 보시면 됩니다.</p><p>하지만, 우리가 흔히 콜백함수라고 부르는 함수들은 조금 더 동작하는 시점이 특정 의미를 가지는 경우가 많습니다. 가장 쉬운 예제로는 브라우저에서 사용자가 특정 버튼을 클릭하면 (특정 시점) 실행되는 함수들이 모두 콜백함수입니다. 또한, 노드에서 파일을 전부 읽고 나면 (특정 시점) 실행되는 함수 역시 콜백함수 입니다. 예제를 통해 직접 만들어 보면서 이해해봅시다.</p><h3 id="callback-function-on-browser"><a href="#callback-function-on-browser" aria-hidden="true" class="header-anchor">#</a> Callback function on browser</h3><p>오래간만에 다시 브라우저로 돌아가봅시다. 이 수업에서는 HTML을 다루지는 않기 때문에 자바스크립트 부분에 집중해서 이해해주시면 됩니다. 아래 예제대로 <code>index.html</code> (브라우저에서 동작시킬 것이기 때문에) 파일을 만들어 주세요.</p><div class="language-html extra-class"><pre class="language-html"><code><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>

	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
		<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span><span class="token punctuation">&gt;</span></span><span class="token script language-javascript">
			console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Hi'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

			<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">cb</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
				console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Tada!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
			<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

			console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'CB?'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>

	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span><span class="token punctuation">&gt;</span></span>
		Callback
	<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p><code>setTimeout</code> 함수는 브라우저에서 기본으로 제공되는 함수로 일정 시간뒤에 콜백함수를 실행시키는 역할을 합니다. 위의 예제를 돌려보면, <code>Hi</code>, <code>CB?</code> 가 출력되었다가 5초뒤에 <code>Tada!</code> 문구가 나오는것을 확인하실 수 있을 겁니다.</p><p>이제 위에서 배운 콜 스택으로 위 예제의 함수 실행을 그려봅시다. 천천히 생각해보세요. 아마 아래처럼 그리시지 않을까 생각됩니다.</p><p align="center"><img src="/assets/img/callstack3.890d3293.png" height="600"></p><p>5번에서 setTimeout은 종료가 된걸까요? 그렇다면 7번 이후에 어떻게 다시 <code>console.log</code>가 돌아오는 걸까요? main() 함수는 종료가 되는 걸까요? 일단 이것에 대한 답은 미뤄두고 Node 환경으로 넘어가서 똑같은 함수를 구현해보죠.</p><h3 id="callback-function-on-node-js"><a href="#callback-function-on-node-js" aria-hidden="true" class="header-anchor">#</a> Callback Function  on Node.js</h3><p>브라우저에서와 완전히 동일한 코드입니다. 한가지 차이가 있다면 setTimeout 함수의 시간이 0이라는 점입니다. 아무것도 기다리지 말고 곧바로 실행하라는 말이지요. 이번에는 결과가 어떻게 출력이 될까요?</p><div class="language-js extra-class"><pre class="language-js"><code>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Hi'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">setTimeout</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token function">cb</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'Tada!'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token string">'CB?'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>돌려보셨으면 아시겠지만, 결과는 브라우저때와 동일한 순서대로 출력됩니다. <code>Hi</code>, <code>CB?</code>, <code>Tada!</code> 순서로 말이죠. 도대체 무슨일이 일어나고 있는 걸까요?</p><h2 id="event-loop"><a href="#event-loop" aria-hidden="true" class="header-anchor">#</a> Event Loop</h2><p>처음 강의에서 여러분에게 노드를 설명하면서 아래와 같은 그림을 보여드렸던 것을 기억하실 겁니다. 다시 한번 정리해보자면, 브라우저와 노드는 내부에 자바스크립트 엔진을 품고 있다는 점에서 동일합니다. 이제 아래 그림에서 비어있는 부분들을 차례로 채워보면서, 왜 <code>Hi</code>, <code>CB</code>, <code>Tada!</code> 순서로 출력되는지 알아봅시다.</p><p align="center"><img src="/assets/img/architecture1.2b5fedce.png" height="300"></p><h3 id="_1-heap-space"><a href="#_1-heap-space" aria-hidden="true" class="header-anchor">#</a> 1. Heap Space</h3><p>가장 먼저 추가되는 영역은 V8 엔진 내부에 힙이라는 영역입니다. 이름이 조금 생소하겠지만 사실 데이터를 저장하는 메모리라고 생각하시면 됩니다. 자바스크립트 엔진은 내부에 일정 크기의 메모리를 시스템으로부터 얻어둡니다. 이후 자바스크립트에서 여러분이 변수를 새롭게 만들거나 함수를 선언하거나 등의 작업을 하면 필요한 값들을 이 힙 영역에 저장합니다. 크롬 브라우저와 노드는 동일하게 V8 엔진을 사용합니다. 그리고 힙의 동작방식은 V8 엔진에 속해있습니다. 때문에, 브라우저와 노드는 Heap 영역에 대해서 만큼은 완전히 동일하게 동작합니다.</p><p align="center"><img src="/assets/img/architecture2.b8527cfa.png" height="300"></p><h3 id="_2-call-stack"><a href="#_2-call-stack" aria-hidden="true" class="header-anchor">#</a> 2. Call stack</h3><p>그렇다면 위에서 새롭게 배운 콜 스택은 어디에 위치할까요? 콜 스택 역시 자바스크립트 엔진 내부에 위치하고 있습니다. 여러분이 작성한 코드를 한줄 한줄 읽으면서 동작시키는 것은 자바스크립트 엔진, 즉 V8 엔진입니다. V8엔진은 위에서 우리가 살펴봤던것처럼 함수 호출이 일어나게 되면 내부에 가지고 있는 콜 스택에 하나씩 필요한 프레임을 쌓게 됩니다.</p><h3 id="_3-asynchronous-apis"><a href="#_3-asynchronous-apis" aria-hidden="true" class="header-anchor">#</a> 3. Asynchronous APIs</h3><p>위 Node 환경 예제에서, setTimeout 함수에 timeout 값을 0으로 주었을때에도 setTimeout 함수에 전달한 콜백함수가 메인함수 이후에 실행되는 것을 확인했습니다. 그리고 왜 이렇게 동작하는지에 대한 답이 바로 브라우저와 Node가 가지고 있는 API 부분에 있습니다. <code>setTimeout</code> 함수는</p></div><div class="content edit-link"><!----><!----></div><!----></div></div></div>
    <script src="/assets/js/6.ca452530.js" defer></script><script src="/assets/js/app.07d17a6a.js" defer></script>
  </body>
</html>
